<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bloxd ãƒ‰ãƒƒãƒˆçµµã‚³ãƒ³ãƒãƒ¼ã‚¿ãƒ¼ (World Codeå¯¾å¿œ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        'bloxd-primary': '#3b82f6',
                        'bloxd-secondary': '#10b981',
                        'bloxd-dark-bg': '#f8fafc',
                        'bloxd-wool': '#f1f5f9',
                        'code-dark': '#1f2937',
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0f4f8; }
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #64748b; border-radius: 10px; }
        .image-rendering-pixelated { image-rendering: pixelated; }
        .tab-button.active { background-color: #10b981; color: white; border-bottom: 3px solid #059669; }
    </style>
</head>
<body class="p-4 sm:p-8 bg-bloxd-dark-bg min-h-screen flex justify-center items-start">

    <div id="app" class="w-full max-w-5xl bg-white shadow-2xl rounded-xl p-6 sm:p-10 my-8">
        
        <h1 class="text-3xl sm:text-4xl font-extrabold text-bloxd-primary mb-2 text-center border-b pb-3">
            ğŸ§± Bloxd ãƒ‰ãƒƒãƒˆçµµã‚³ãƒ³ãƒãƒ¼ã‚¿ãƒ¼ <span class="text-sm text-gray-500 font-normal">Ver 2.2 (æ–‡å­—æ•°åˆ¶é™è¿½åŠ )</span>
        </h1>
        <p class="text-center text-gray-600 mb-8 mt-2">
            Code Blockç”¨ï¼ˆåˆ†å‰²ï¼‰ã¨ World Codeç”¨ï¼ˆåœ§ç¸®ãƒ»æœ€é©åŒ–ï¼‰ã®ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã™ã€‚
        </p>

        <div class="space-y-8 p-6 bg-bloxd-wool rounded-xl shadow-inner border border-gray-200">
            <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                <span class="bg-bloxd-secondary text-white rounded-full w-8 h-8 flex items-center justify-center mr-3 text-lg">1</span>
                è¨­å®šã¨ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                
                <div class="col-span-1 space-y-4 p-4 bg-white rounded-lg shadow-md">
                    <label class="block text-lg font-semibold text-gray-800">ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</label>
                    <input type="file" id="imageUpload" accept="image/*" class="w-full text-sm text-gray-600
                        file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0
                        file:text-sm file:font-semibold file:bg-bloxd-primary file:text-white
                        hover:file:bg-blue-600 cursor-pointer transition duration-150"/>
                </div>

                <div class="col-span-1 space-y-4 p-4 bg-white rounded-lg shadow-md">
                    <label class="block text-lg font-semibold text-gray-800">ã‚µã‚¤ã‚ºè¨­å®š (ãƒ–ãƒ­ãƒƒã‚¯æ•°)</label>
                    <div class="flex items-center space-x-4">
                        <div class="flex-1">
                            <label class="block text-xs text-gray-500 mb-1">ç¸¦ (é«˜ã•) <span class="text-red-500">*æ“ä½œå¯èƒ½</span></label>
                            <input type="number" id="inputHeight" value="30" min="1" class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-bloxd-primary outline-none text-center font-bold text-lg">
                        </div>
                        <span class="text-gray-400 font-bold">Ã—</span>
                        <div class="flex-1">
                            <label class="block text-xs text-gray-500 mb-1">æ¨ª (å¹…) <span class="text-gray-400">*è‡ªå‹•è¨ˆç®—</span></label>
                            <input type="number" id="inputWidth" value="-" readonly class="w-full p-2 bg-gray-100 border border-gray-300 rounded text-center text-gray-500 font-bold text-lg cursor-not-allowed">
                        </div>
                    </div>
                    <p id="aspectRatioDisplay" class="text-xs text-right text-bloxd-primary font-medium">æ¯”ç‡: -</p>
                </div>

                <div class="col-span-1 space-y-4 p-4 bg-white rounded-lg shadow-md">
                    <label class="block text-lg font-semibold text-gray-800">é–‹å§‹åº§æ¨™ (X, Y, Z)</label>
                    <div class="flex space-x-2">
                        <input type="number" id="startX" value="100" class="w-1/3 p-2 border rounded text-center" placeholder="X">
                        <input type="number" id="startY" value="60" class="w-1/3 p-2 border rounded text-center" placeholder="Y">
                        <input type="number" id="startZ" value="200" class="w-1/3 p-2 border rounded text-center" placeholder="Z">
                    </div>
                </div>

                <div class="col-span-1 space-y-4 p-4 bg-white rounded-lg shadow-md border-2 border-bloxd-secondary/20">
                    <label class="block text-lg font-semibold text-gray-800">å‡ºåŠ›ãƒ¢ãƒ¼ãƒ‰</label>
                    <div class="space-y-2">
                        <label class="flex items-center p-2 rounded hover:bg-gray-50 cursor-pointer">
                            <input type="radio" name="mode" value="codeblock" checked class="w-5 h-5 text-bloxd-secondary focus:ring-bloxd-secondary">
                            <div class="ml-3">
                                <span class="block font-bold text-gray-800">Code Blockç”¨</span>
                                <span class="block text-xs text-gray-500">200ãƒ–ãƒ­ãƒƒã‚¯ã”ã¨ã«åˆ†å‰²å‡ºåŠ› (api.setBlockä½¿ç”¨)</span>
                            </div>
                        </label>
                        <label class="flex items-center p-2 rounded hover:bg-gray-50 cursor-pointer">
                            <input type="radio" name="mode" value="worldcode" class="w-5 h-5 text-bloxd-secondary focus:ring-bloxd-secondary">
                            <div class="ml-3">
                                <span class="block font-bold text-indigo-600">World Codeç”¨ (æœ€é©åŒ–)</span>
                                <span class="block text-xs text-gray-500">setBlockWallsã§åœ§ç¸®ã—ã€16,000æ–‡å­—ä»¥å†…ã«åã‚ã¾ã™</span>
                            </div>
                        </label>
                    </div>
                </div>

            </div>
            
            <div class="pt-4 flex justify-center">
                <button id="convertButton" class="px-10 py-4 bg-bloxd-secondary text-white text-xl font-bold rounded-full shadow-lg hover:bg-emerald-600 transition duration-300 transform hover:scale-105 disabled:opacity-50">
                    å¤‰æ›å®Ÿè¡Œ
                </button>
            </div>
        </div>
        
        <div id="errorMessage" class="hidden mt-6 p-4 bg-red-100 border-l-4 border-red-500 text-red-700 rounded-lg">
            <p class="font-bold">Error: æ–‡å­—æ•°ãŒ16000æ–‡å­—ä»¥ä¸Šã§ã™</p>
            <p class="text-sm">World Codeã®åˆ¶é™ã‚’è¶…éã—ã¾ã—ãŸã€‚ã‚µã‚¤ã‚ºè¨­å®šï¼ˆç¸¦ã®ãƒ–ãƒ­ãƒƒã‚¯æ•°ï¼‰ã‚’å°ã•ãã—ã¦ãã ã•ã„ã€‚</p>
        </div>


        <div id="outputSection" class="mt-10 hidden">
            <div class="flex flex-col md:flex-row gap-8">
                <div class="md:w-1/3">
                    <h3 class="font-bold text-lg text-gray-700 mb-2">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h3>
                    <div class="p-4 bg-gray-100 rounded-lg shadow-inner flex justify-center">
                        <canvas id="previewCanvas" class="max-w-full h-auto border-4 border-white shadow-md image-rendering-pixelated"></canvas>
                    </div>
                </div>
                <div class="md:w-2/3">
                    <h3 class="font-bold text-lg text-gray-700 mb-2 flex justify-between items-end">
                        <span>ç”Ÿæˆã‚³ãƒ¼ãƒ‰</span>
                        <span id="charCount" class="text-xs font-normal text-gray-500"></span>
                    </h3>
                    
                    <div id="tabContainer" class="hidden mb-0 flex overflow-x-auto border-b-2 border-gray-200"></div>
                    
                    <textarea id="outputCode" rows="12" readonly class="w-full p-4 border border-gray-300 rounded-b-lg bg-code-dark text-green-400 font-mono text-xs custom-scrollbar"></textarea>
                    
                    <button id="copyButton" class="mt-3 px-6 py-2 bg-bloxd-primary text-white rounded-lg hover:bg-blue-600 transition w-full font-bold">
                        ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼
                    </button>
                </div>
            </div>
        </div>

        <div id="loading" class="hidden text-center mt-10 text-bloxd-secondary font-bold text-xl">
            å‡¦ç†ä¸­...
        </div>

    </div>

    <script>
        // --- å®šæ•°ãƒ»ãƒ‘ãƒ¬ãƒƒãƒˆ ---
        const MAX_CHARS_WORLDCODE = 16000; // World Codeã®æ–‡å­—æ•°åˆ¶é™
        const MAX_BLOCKS_CODEBLOCK = 200; // Code Blockç”¨åˆ†å‰²æ•°
        
        // 32è‰²ãƒ‘ãƒ¬ãƒƒãƒˆ (Concrete + Wool)
        const PALETTE = {
            'White Concrete': [200, 203, 207], 'Light Gray Concrete': [135, 137, 140], 'Gray Concrete': [80, 80, 84], 'Black Concrete': [25, 27, 30],
            'Brown Concrete': [95, 60, 42], 'Red Concrete': [142, 38, 32], 'Orange Concrete': [220, 94, 25], 'Yellow Concrete': [237, 178, 20],
            'Lime Concrete': [95, 169, 21], 'Green Concrete': [77, 98, 32], 'Cyan Concrete': [18, 126, 133], 'Light Blue Concrete': [65, 137, 186],
            'Blue Concrete': [43, 44, 138], 'Purple Concrete': [112, 45, 166], 'Magenta Concrete': [178, 59, 141], 'Pink Concrete': [215, 108, 138],
            'White Wool': [240, 240, 240], 'Light Gray Wool': [180, 180, 180], 'Gray Wool': [130, 130, 130], 'Black Wool': [50, 50, 50],
            'Brown Wool': [140, 100, 75], 'Red Wool': [200, 70, 60], 'Orange Wool': [240, 140, 50], 'Yellow Wool': [250, 200, 50],
            'Lime Wool': [140, 200, 50], 'Green Wool': [110, 130, 60], 'Cyan Wool': [40, 160, 170], 'Light Blue Wool': [100, 180, 220],
            'Blue Wool': [70, 70, 190], 'Purple Wool': [150, 70, 200], 'Magenta Wool': [210, 90, 170], 'Pink Wool': [240, 150, 170]
        };

        // World Codeåœ§ç¸®ç”¨ã®çŸ­ç¸®åãƒãƒƒãƒ—
        const SHORT_NAMES = {};
        const REVERSE_SHORT_NAMES = {};
        let shortIndex = 0;
        for (let key in PALETTE) {
            const short = "B" + (shortIndex++).toString(36).toUpperCase(); 
            SHORT_NAMES[key] = short;
            REVERSE_SHORT_NAMES[short] = key;
        }

        let loadedImg = null;
        let aspectRatio = 0;

        // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ ---
        document.getElementById('imageUpload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if(!file) return;
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    loadedImg = img;
                    aspectRatio = img.width / img.height;
                    updateWidthFromHeight(); // ç”»åƒèª­ã¿è¾¼ã¿æ™‚ã«å¹…ã‚’è¨ˆç®—
                }
                img.src = event.target.result;
            }
            reader.readAsDataURL(file);
        });

        document.getElementById('inputHeight').addEventListener('input', updateWidthFromHeight);
        document.getElementById('convertButton').addEventListener('click', startConversion);

        // --- é–¢æ•° ---

        function updateWidthFromHeight() {
            const hInput = document.getElementById('inputHeight');
            const wInput = document.getElementById('inputWidth');
            const arDisplay = document.getElementById('aspectRatioDisplay');
            
            if (!loadedImg) {
                wInput.value = "-";
                arDisplay.textContent = "ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„";
                return;
            }

            let h = parseInt(hInput.value);
            if(isNaN(h) || h < 1) h = 1;
            
            const w = Math.round(h * aspectRatio);
            wInput.value = w;
            arDisplay.textContent = `å…ƒã®ã‚µã‚¤ã‚º: ${loadedImg.width}x${loadedImg.height} (æ¯”ç‡ ${aspectRatio.toFixed(2)})`;
        }

        function getColorDistance(rgb1, rgb2) {
            return Math.pow(rgb1[0]-rgb2[0],2) + Math.pow(rgb1[1]-rgb2[1],2) + Math.pow(rgb1[2]-rgb2[2],2);
        }

        function getNearestBlock(r, g, b) {
            let min = Infinity;
            let nearest = "White Concrete";
            for (let key in PALETTE) {
                let d = getColorDistance([r,g,b], PALETTE[key]);
                if (d < min) { min = d; nearest = key; }
            }
            return nearest;
        }

        async function startConversion() {
            if (!loadedImg) return alert("ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„");
            
            // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’éè¡¨ç¤ºã«ã™ã‚‹
            document.getElementById('errorMessage').classList.add('hidden');
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('outputSection').style.display = 'none';

            // å°‘ã—å¾…ã£ã¦UIæ›´æ–°ã•ã›ã‚‹
            await new Promise(r => setTimeout(r, 50));

            const h = parseInt(document.getElementById('inputHeight').value);
            const w = parseInt(document.getElementById('inputWidth').value);
            const sx = parseInt(document.getElementById('startX').value);
            const sy = parseInt(document.getElementById('startY').value);
            const sz = parseInt(document.getElementById('startZ').value);
            const mode = document.querySelector('input[name="mode"]:checked').value;

            // Canvaså‡¦ç†
            const canvas = document.getElementById('previewCanvas');
            const ctx = canvas.getContext('2d');
            canvas.width = w;
            canvas.height = h;
            
            // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºã®èª¿æ•´ (CSS)
            const maxDimension = 400; 
            const scale = Math.min(maxDimension/w, maxDimension/h);
            canvas.style.width = (w * Math.max(1, scale)) + "px";
            canvas.style.height = (h * Math.max(1, scale)) + "px";

            ctx.drawImage(loadedImg, 0, 0, w, h);
            const imgData = ctx.getImageData(0, 0, w, h).data;

            // ãƒ–ãƒ­ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ [y][z] = blockName
            let grid = [];
            for(let y=0; y<h; y++) {
                grid[y] = [];
                for(let x=0; x<w; x++) { 
                    const i = (y * w + x) * 4;
                    // é€éãƒ”ã‚¯ã‚»ãƒ«ã¯ã‚¹ã‚­ãƒƒãƒ— (Air)
                    if (imgData[i+3] < 128) {
                        grid[y][x] = null;
                        continue;
                    }
                    const block = getNearestBlock(imgData[i], imgData[i+1], imgData[i+2]);
                    grid[y][x] = block;

                    // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å¡—ã‚Šç›´ã—
                    const c = PALETTE[block];
                    ctx.fillStyle = `rgb(${c[0]},${c[1]},${c[2]})`;
                    ctx.fillRect(x, y, 1, 1);
                }
            }

            // ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
            let resultCodes = [];
            
            if (mode === 'codeblock') {
                resultCodes = generateCodeBlock(grid, sx, sy, sz, w, h);
                setupTabs(resultCodes);
                document.getElementById('outputSection').style.display = 'block';
            } else {
                const code = generateWorldCode(grid, sx, sy, sz, w, h);
                
                // â˜… World Codeã®æ–‡å­—æ•°ãƒã‚§ãƒƒã‚¯ã¨ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
                if (code.length > MAX_CHARS_WORLDCODE) {
                    document.getElementById('loading').classList.add('hidden');
                    document.getElementById('errorMessage').classList.remove('hidden');
                    return; // å¤‰æ›å‡¦ç†ã‚’ã“ã“ã§ä¸­æ–­
                }
                
                resultCodes = [code];
                setupTabs(resultCodes, true); // WorldCodeãƒ¢ãƒ¼ãƒ‰
                document.getElementById('outputSection').style.display = 'block';
            }

            document.getElementById('loading').classList.add('hidden');
        }

        // --- Code Blockç”¨ç”Ÿæˆ (å˜ç´”ç¾…åˆ—ãƒ»åˆ†å‰²) ---
        function generateCodeBlock(grid, sx, sy, sz, w, h) {
            let blocks = [];
            for(let y=0; y<h; y++) {
                for(let x=0; x<w; x++) {
                    if(!grid[y][x]) continue;
                    blocks.push(`api.setBlock(${sx},${sy + (h - 1 - y)},${sz + x},"${grid[y][x]}")`);
                }
            }

            let chunks = [];
            let codeBlockTemplate = (content) => `
// Bloxd Code Block #${chunks.length + 1}
// ${content.length} blocks
tick=()=>{
  [
    ${content}
  ].forEach(api.eval); // setBlockã‚’forEachã§å®Ÿè¡Œ
}
`.trim();
            
            for (let i = 0; i < blocks.length; i += MAX_BLOCKS_CODEBLOCK) {
                let chunk = blocks.slice(i, i + MAX_BLOCKS_CODEBLOCK);
                let blockStrings = chunk.map(cmd => `"${cmd.replace(/"/g, '\\"')}"`);
                chunks.push(codeBlockTemplate(blockStrings.join(',\n    ')));
            }
            
            if (chunks.length === 0 && blocks.length > 0) {
                 chunks.push(codeBlockTemplate(blocks.join(',\n    ')));
            }
            
            return chunks;
        }


        // --- World Codeç”¨ç”Ÿæˆ (Greedy Meshing & setBlockWalls) ---
        function generateWorldCode(grid, sx, sy, sz, w, h) {
            let commands = [];
            let processed = Array(h).fill().map(() => Array(w).fill(false));

            for(let y=0; y<h; y++) {
                for(let x=0; x<w; x++) {
                    if(!grid[y][x] || processed[y][x]) continue;

                    let block = grid[y][x];
                    
                    // æ¨ª(Z)ã«ä¼¸ã°ã™
                    let width = 1;
                    while(x + width < w && grid[y][x + width] === block && !processed[y][x + width]) {
                        width++;
                    }

                    // ç¸¦(Y)ã«ä¼¸ã°ã™
                    let height = 1;
                    while(y + height < h) {
                        let canExtend = true;
                        for(let k=0; k<width; k++) {
                            if(grid[y + height][x + k] !== block || processed[y + height][x + k]) {
                                canExtend = false;
                                break;
                            }
                        }
                        if(!canExtend) break;
                        height++;
                    }

                    // å‡¦ç†æ¸ˆã¿ãƒãƒ¼ã‚¯
                    for(let dy=0; dy<height; dy++) {
                        for(let dx=0; dx<width; dx++) {
                            processed[y + dy][x + dx] = true;
                        }
                    }

                    // åº§æ¨™å¤‰æ› (Bloxd Yè»¸ã¯é€†è»¢)
                    let z1 = sz + x;
                    let z2 = sz + x + width - 1;
                    let y1 = sy + (h - 1 - y); // ä¸Šç«¯
                    let y2 = sy + (h - 1 - (y + height - 1)); // ä¸‹ç«¯
                    
                    const shortName = SHORT_NAMES[block];
                    
                    if (width === 1 && height === 1) {
                        // setBlockç”¨: [y, z, code]
                        commands.push(`[${y1},${z1},"${shortName}"]`);
                    } else {
                        // setBlockWallsç”¨: [y1, y2, z1, z2, code]
                        commands.push(`[${y1},${y2},${z1},${z2},"${shortName}"]`);
                    }
                }
            }

            // World Code ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”Ÿæˆ
            let mapObj = {};
            for(let k in SHORT_NAMES) mapObj[SHORT_NAMES[k]] = k;
            const mapJSON = JSON.stringify(mapObj);

            // ãƒ‡ãƒ¼ã‚¿é…åˆ—
            const dataStr = `[${commands.join(',')}]`;

            // å®Ÿè¡Œç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
            return `
/* World Code (Auto Generated) */
const D=${dataStr};
const M=${mapJSON};
const X=${sx};
// è² è·åˆ†æ•£ã®ãŸã‚tickã§å°‘ã—ãšã¤å‡¦ç†
let idx=0;
tick=()=>{
  let c=0;
  while(idx<D.length && c<50){ // 1tick 50ã‚³ãƒãƒ³ãƒ‰åˆ¶é™
    let d=D[idx++];
    
    // é…åˆ—ã®é•·ã•ã§ãƒ–ãƒ­ãƒƒã‚¯ã‚³ãƒ¼ãƒ‰ã®ä½ç½®ã‚’åˆ¤å®š
    let blockCode = d.length === 3 ? d[2] : d[4]; 
    let n = M[blockCode]; // åå‰å–å¾—
    
    if(!n) {
      api.sendMessage(api.getPlayerIds()[0], "âŒ Error: Unknown Block Code: " + blockCode);
      continue; 
    }

    if(d.length===3) {
      // setBlock(X, Y, Z, name)
      api.setBlock(X,d[0],d[1],n);
    } else {
      // setBlockWalls([x1, y1, z1], [x2, y2, z2], blockName, solid, wall)
      // d = [y1, y2, z1, z2, code]
      api.setBlockWalls([X,d[0],d[2]],[X,d[1],d[3]],n,true,true);
    }
    c++;
  }
  if(idx===D.length){api.sendMessage(api.getPlayerIds()[0], "âœ… æç”»å®Œäº†"); idx++;}
}
`.trim();
        }

        // --- UIæ“ä½œ ---
        let currentCodes = [];
        
        function setupTabs(codes, isWorldCode = false) {
            currentCodes = codes;
            const tabContainer = document.getElementById('tabContainer');
            const textArea = document.getElementById('outputCode');
            const charCount = document.getElementById('charCount');
            const copyButton = document.getElementById('copyButton');

            tabContainer.innerHTML = "";
            
            if (isWorldCode) {
                tabContainer.classList.add('hidden');
                let code = codes[0] || "";
                textArea.value = code;
                charCount.innerText = `æ–‡å­—æ•°: ${code.length} / ${MAX_CHARS_WORLDCODE} (æ¨å¥¨)`;
                copyButton.onclick = () => copyText(code);
            } else {
                // Code Blockç”¨ã®å ´åˆ
                tabContainer.classList.remove('hidden');
                
                let initialCode = codes[0] || "";
                
                codes.forEach((code, i) => {
                    const btn = document.createElement('button');
                    btn.className = `px-4 py-2 border-b-2 font-bold text-sm transition-colors ${i===0 ? 'border-bloxd-secondary text-bloxd-secondary' : 'border-transparent text-gray-500 hover:text-gray-700'}`;
                    btn.innerText = `Block ${i+1}`;
                    btn.onclick = () => {
                        Array.from(tabContainer.children).forEach(b => {
                            b.className = b.className.replace('border-bloxd-secondary text-bloxd-secondary', 'border-transparent text-gray-500');
                        });
                        btn.className = btn.className.replace('border-transparent text-gray-500', 'border-bloxd-secondary text-bloxd-secondary');
                        textArea.value = code;
                        charCount.innerText = `æ–‡å­—æ•°: ${code.length}`;
                        copyButton.onclick = () => copyText(code);
                    };
                    tabContainer.appendChild(btn);
                });
                
                // åˆæœŸè¡¨ç¤º
                textArea.value = initialCode;
                charCount.innerText = `æ–‡å­—æ•°: ${initialCode.length}`;
                copyButton.onclick = () => copyText(initialCode); 
            }
        }

        function copyText(text) {
            if (!text) {
                alert("ã‚³ãƒ”ãƒ¼ã™ã‚‹ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“ã€‚");
                return;
            }
            navigator.clipboard.writeText(text).then(() => {
                alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
            }).catch(err => {
                console.error('ã‚³ãƒ”ãƒ¼å¤±æ•—:', err);
                alert("ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã‹ã‚‰æ‰‹å‹•ã§ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚");
            });
        }

    </script>
</body>
</html>
